<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tuti</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">

    <style>
        .puntoventa{
            margin: 30px;
        }
    </style>
</head>
<body>
    
    <div class="container text-center">
        <h1>Punto de venta</h1>
    </div>

    <div class="card puntoventa">
        <div class="card-body">
            <div class="row">
                <div class="col-sm-3">
                    <h2>Buscar Producto: </h2>
                </div>
                <div class="col-sm-4">
                    <input type="text" class="form-control" id="idBuscarProducto">
                </div>
                <div class="col-sm-4">
                    <button class="btn btn-primary">Buscar</button>
                </div>
            </div>
<br>
            <div class="row">
                <div class="col-sm-6">
                    <table id="tablaDetalle" class="table table-dark table-striped-columns">
                        <thead>
                            <tr>
                                <th>codigo</th>
                                <th>Descripcion</th>
                                <th>cantidad</th>
                                <th>Precio</th>
                            </tr>
                        </thead>
                        <tbody>

                        </tbody>
                    </table>
                </div>

                <div class="col-sm-5">
                    <h2>SubTotal</h2>
                    <p id="subtotal" style="font-size: x-large;padding:10px; background-color: black; color: green;font-family:Impact, Haettenschweiler, 'Arial Narrow Bold', sans-serif">$ 0.0</p>
                    <h2>Iva</h2>
                    <p style="font-size: x-large;padding:10px; background-color: black; color: green;font-family:Impact, Haettenschweiler, 'Arial Narrow Bold', sans-serif">12%</p>
                    <h2>Total</h2>
                    <p id="total" style="font-size: x-large;padding:10px; background-color: black; color: green;font-family:Impact, Haettenschweiler, 'Arial Narrow Bold', sans-serif">$ 0.0</p>
                </div>
               
            </div>

        </div>
    </div>


    <script>
          const inputQR = document.getElementById('idBuscarProducto');

          let debounceTimeout;
            inputQR.addEventListener('input', function () {
                 clearTimeout(debounceTimeout); // Limpiar la espera anterior
                    debounceTimeout = setTimeout(() => {
                        const valor = inputQR.value.trim();
                        if (valor !== "") {
                            buscarProductoPorCodigo(valor);
                        }
                    }, 300); // Espera 300 ms desde la Ãºltima tecla antes de buscar
            });

            let detalleProductos=[];
            function buscarProductoPorCodigo(valor){
                console.log(valor);
                fetch('https://crudcrud.com/api/a35a33cf2ccf4dd096eb6eda4a5c1415/productos/')//https://crudcrud.com/api/15c27e9bdde1473abd17c6d447aff1c8/productos/
                .then(response => response.json())
                .then(data => {
                    const productoEncontrado = data.find(p => p.codigo == valor);
                    console.log("Producto ENcontraod: "+productoEncontrado);
                    if(productoEncontrado){
                        detalleProductos.push(productoEncontrado);
                        const tabla = document.querySelector("#tablaDetalle tbody");
                        tabla.innerHTML='';
                        let subtotal=0;
                        detalleProductos.forEach(element => {
                            const fila = document.createElement("tr");
                            fila.innerHTML=`
                               <td>${element.codigo}</td>
                               <td>${element.descripcion}</td>
                               <td>1</td>
                               <td>${element.precio}</td>
                            `;
                            tabla.appendChild(fila);
                            subtotal = subtotal + parseFloat(element.precio)
                        });
                        actualizarTotal(subtotal)
                        inputQR.value='';
                    }else{
                        console.log("Producto no encontrado");
                    }
                }
            
                ).catch(error => console.error("Error al buscar producto:", error));

            }

            function actualizarTotal(subtotal){
                let subtotalObtenido = document.getElementById("subtotal");
                subtotalObtenido.innerHTML=`$ ${subtotal.toFixed(2)}`;
                
                let total = subtotal * 1.12;
                document.getElementById("total").innerHTML=`$ ${total.toFixed(2)}`;
            }


    </script>



</body>
</html>